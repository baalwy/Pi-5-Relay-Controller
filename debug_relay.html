<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØµØ­ÙŠØ­ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø±ÙŠÙ„Ø§ÙŠØ§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Arial', sans-serif; padding: 2rem; }
        .debug-section { margin-bottom: 2rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; }
        .log-area { height: 200px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border-radius: 4px; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }
        .status-card { padding: 1rem; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        .status-on { background: #d4edda; border-color: #c3e6cb; }
        .status-off { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ØªØµØ­ÙŠØ­ Ø£Ø®Ø·Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠÙ„Ø§ÙŠØ§Øª</h1>
        
        <div class="debug-section">
            <h3>ğŸ“Š Ø­Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙŠÙ„Ø§ÙŠØ§Øª</h3>
            <button class="btn btn-primary mb-3" onclick="checkAllStatuses()">ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>
            <div class="status-grid" id="statusGrid"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙŠÙ„ÙŠ ÙˆØ§Ø­Ø¯</h3>
            <div class="row">
                <div class="col-md-3">
                    <input type="number" class="form-control" id="testRelay" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø±ÙŠÙ„ÙŠ (1-16)" min="1" max="16" value="1">
                </div>
                <div class="col-md-9">
                    <button class="btn btn-success me-2" onclick="testRelay('on')">ØªØ´ØºÙŠÙ„</button>
                    <button class="btn btn-danger me-2" onclick="testRelay('off')">Ø¥ÙŠÙ‚Ø§Ù</button>
                    <button class="btn btn-info me-2" onclick="testRelay('toggle')">ØªØ¨Ø¯ÙŠÙ„</button>
                    <button class="btn btn-secondary" onclick="testRelay('status')">ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
                </div>
            </div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
            <button class="btn btn-warning mb-2" onclick="clearLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            <div class="log-area" id="logArea"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h3>
            <button class="btn btn-info" onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</button>
            <div id="connectionStatus" class="mt-2"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        let logCount = 0;
        
        function log(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('logArea');
            const color = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            logArea.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
            logCount = 0;
        }
        
        function checkAllStatuses() {
            log('Ø¨Ø¯Ø¡ ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙŠÙ„Ø§ÙŠØ§Øª...');
            const grid = document.getElementById('statusGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 16; i++) {
                const card = document.createElement('div');
                card.className = 'status-card';
                card.id = `status-card-${i}`;
                card.innerHTML = `<strong>Ø±ÙŠÙ„ÙŠ ${i}</strong><br><span id="status-${i}">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>`;
                grid.appendChild(card);
                
                // Check status
                $.get(`/status/${i}`)
                    .done(function(data) {
                        const isOn = parseInt(data) > 0;
                        const statusText = isOn ? 'Ù…ÙØ´ØºÙ„' : 'Ù…ÙØ·ÙØ£';
                        const statusClass = isOn ? 'status-on' : 'status-off';
                        
                        document.getElementById(`status-${i}`).textContent = statusText;
                        document.getElementById(`status-card-${i}`).className = `status-card ${statusClass}`;
                        
                        log(`Ø±ÙŠÙ„ÙŠ ${i}: ${statusText}`, isOn ? 'success' : 'info');
                    })
                    .fail(function() {
                        document.getElementById(`status-${i}`).textContent = 'Ø®Ø·Ø£';
                        log(`Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø±ÙŠÙ„ÙŠ ${i}`, 'error');
                    });
            }
        }
        
        function testRelay(action) {
            const relayNum = document.getElementById('testRelay').value;
            if (!relayNum || relayNum < 1 || relayNum > 16) {
                log('Ø±Ù‚Ù… Ø±ÙŠÙ„ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­!', 'error');
                return;
            }
            
            let url;
            switch(action) {
                case 'on':
                    url = `/on/${relayNum}`;
                    break;
                case 'off':
                    url = `/off/${relayNum}`;
                    break;
                case 'toggle':
                    url = `/toggle/${relayNum}`;
                    break;
                case 'status':
                    url = `/status/${relayNum}`;
                    break;
                default:
                    log('Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!', 'error');
                    return;
            }
            
            log(`ØªÙ†ÙÙŠØ° ${action} Ø¹Ù„Ù‰ Ø±ÙŠÙ„ÙŠ ${relayNum}...`);
            
            $.get(url)
                .done(function(data) {
                    if (action === 'status') {
                        const isOn = parseInt(data) > 0;
                        const statusText = isOn ? 'Ù…ÙØ´ØºÙ„' : 'Ù…ÙØ·ÙØ£';
                        log(`Ø±ÙŠÙ„ÙŠ ${relayNum}: ${statusText}`, isOn ? 'success' : 'info');
                    } else {
                        log(`ØªÙ… ØªÙ†ÙÙŠØ° ${action} Ø¹Ù„Ù‰ Ø±ÙŠÙ„ÙŠ ${relayNum} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                        // Check status after action
                        setTimeout(() => {
                            $.get(`/status/${relayNum}`)
                                .done(function(statusData) {
                                    const isOn = parseInt(statusData) > 0;
                                    const statusText = isOn ? 'Ù…ÙØ´ØºÙ„' : 'Ù…ÙØ·ÙØ£';
                                    log(`Ø­Ø§Ù„Ø© Ø±ÙŠÙ„ÙŠ ${relayNum} Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: ${statusText}`, 'info');
                                });
                        }, 500);
                    }
                })
                .fail(function() {
                    log(`ÙØ´Ù„ ÙÙŠ ØªÙ†ÙÙŠØ° ${action} Ø¹Ù„Ù‰ Ø±ÙŠÙ„ÙŠ ${relayNum}`, 'error');
                });
        }
        
        function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            
            $.get('/status/1')
                .done(function() {
                    statusDiv.innerHTML = '<div class="alert alert-success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</div>';
                    log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„: Ù†Ø¬Ø­', 'success');
                })
                .fail(function() {
                    statusDiv.innerHTML = '<div class="alert alert-danger">âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</div>';
                    log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„: ÙØ´Ù„', 'error');
                });
        }
        
        // Initialize
        $(document).ready(function() {
            log('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„ØªØµØ­ÙŠØ­');
            testConnection();
        });
    </script>
</body>
</html>
